//
//  MaketDataModel.swift
//  SwiftCrypto
//
//  Created by 668 on 29.01.2022.
//

import Foundation
// JSON data
/*
https://api.coingecko.com/api/v3/global
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 12902,
     "upcoming_icos": 0,
     "ongoing_icos": 50,
     "ended_icos": 3375,
     "markets": 727,
     "total_market_cap": {
       "btc": 47341602.81317994,
       "eth": 709847944.7323512,
       "ltc": 16310675257.543827,
       "bch": 6067758223.85272,
       "bnb": 4563431822.315105,
       "eos": 781466431050.803,
       "xrp": 2930421536574.084,
       "xlm": 9011338784593.188,
       "link": 111053650675.21597,
       "dot": 97736190426.57886,
       "yfi": 75685139.42839438,
       "usd": 1788528893638.172,
       "aed": 6569266626332.998,
       "ars": 187509635699831.06,
       "aud": 2556059971582.9507,
       "bdt": 153611068095345.28,
       "bhd": 674295066719.4192,
       "bmd": 1788528893638.172,
       "brl": 9624252829556.373,
       "cad": 2284609575808.8047,
       "chf": 1665267059346.4187,
       "clp": 1454753631507416.8,
       "cny": 11377368851100.502,
       "czk": 39283710060323.414,
       "dkk": 11938687913195.492,
       "eur": 1604011733268.2036,
       "gbp": 1335018776193.9158,
       "hkd": 13937299199209.318,
       "huf": 575719375654172.6,
       "idr": 25748310403639332,
       "ils": 5727567043697.929,
       "inr": 134163356088059.33,
       "jpy": 206113348666539.7,
       "krw": 2165567330097893.2,
       "kwd": 542017258274.8342,
       "lkr": 361080115707461.56,
       "mmk": 3178220197274362,
       "mxn": 37202742384344.23,
       "myr": 7493936064343.959,
       "ngn": 743419919929645,
       "nok": 16045676080483.453,
       "nzd": 2732308762877.6313,
       "php": 91439439317285.17,
       "pkr": 316480187729274.94,
       "pln": 7355217763353.383,
       "rub": 139674806242894.23,
       "sar": 6710694548597.44,
       "sek": 16864335833910.693,
       "sgd": 2424592366727.1846,
       "thb": 59818243112175.695,
       "try": 24187304632782.87,
       "twd": 49798906038543.45,
       "uah": 51177386066852.47,
       "vef": 179085398119.99042,
       "vnd": 40510179440904616,
       "zar": 27898899140496.48,
       "xdr": 1276029516223.9414,
       "xag": 79836138130.75339,
       "xau": 999859192.6994838,
       "bits": 47341602813179.94,
       "sats": 4734160281317994
     },
     "total_volume": {
       "btc": 3599801.7908246424,
       "eth": 53976032.72420909,
       "ltc": 1240245249.688063,
       "bch": 461385454.28451234,
       "bnb": 346998180.672131,
       "eos": 59421821205.910805,
       "xrp": 222825930437.1008,
       "xlm": 685211981996.4156,
       "link": 8444393658.487627,
       "dot": 7431749083.66277,
       "yfi": 5755012.172450067,
       "usd": 135997708815.80432,
       "aed": 499519584480.4487,
       "ars": 14258020055907.535,
       "aud": 194359901574.72742,
       "bdt": 11680411417463.943,
       "bhd": 51272632198.35508,
       "bmd": 135997708815.80432,
       "brl": 731817270908.7251,
       "cad": 173719121314.62634,
       "chf": 126625018719.63689,
       "clp": 110617816396598.94,
       "cny": 865122225089.976,
       "czk": 2987088763839.204,
       "dkk": 907804290015.564,
       "eur": 121967233190.4043,
       "gbp": 101513313782.21611,
       "hkd": 1059776425706.5831,
       "huf": 43777048438152.086,
       "idr": 1957872323577625,
       "ils": 435517702734.64233,
       "inr": 10201629450838.604,
       "jpy": 15672625292612.807,
       "krw": 164667283948980.1,
       "kwd": 41214377652.04705,
       "lkr": 27456122520486.76,
       "mmk": 241668259584107.75,
       "mxn": 2828854341650.3433,
       "myr": 569830399938.2214,
       "ngn": 56528807646377.41,
       "nok": 1220095012783.0417,
       "nzd": 207761659792.27206,
       "php": 6952951270055.54,
       "pkr": 24064794574956.605,
       "pln": 559282417642.4678,
       "rub": 10620713870428.469,
       "sar": 510273603305.05865,
       "sek": 1282344972043.8843,
       "sgd": 184363253990.51297,
       "thb": 4548511370198.999,
       "try": 1839175214998.693,
       "twd": 3786652341410.565,
       "uah": 3891470399516.9824,
       "vef": 13617450583.726507,
       "vnd": 3080348104677969.5,
       "zar": 2121400652282.8452,
       "xdr": 97027837350.05324,
       "xag": 6070649406.394808,
       "xau": 76028159.13638726,
       "bits": 3599801790824.6426,
       "sats": 359980179082464.25
     },
     "market_cap_percentage": {
       "btc": 40.012435698908845,
       "eth": 16.84273837737582,
       "usdt": 4.429180966569949,
       "bnb": 3.717359500323995,
       "usdc": 2.795544760467083,
       "ada": 1.895369474325787,
       "sol": 1.6458623816648896,
       "xrp": 1.6343596030487388,
       "luna": 1.124251674032972,
       "dot": 1.1093297142803173
     },
     "market_cap_change_percentage_24h_usd": 4.456279763716272,
     "updated_at": 1643403806
   }
 }
*/

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    var marketCap: String {
        if let item = totalMarketCap.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return""
    }
    
    var btcDominance: String {
            if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
                return item.value.asPercentString()
            }
            return""
        }
    }

